<!DOCTYPE html>
<html
  lang="en-US"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="false"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="en-US" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Alaska 2020 Early Vote Tracker - Rmarkdown report &middot; Ben Matheson</title>
    <meta name="title" content="Alaska 2020 Early Vote Tracker - Rmarkdown report &middot; Ben Matheson" />
  
  
  
  
  
  <link rel="canonical" href="/posts/mail-in-2020/" />
  
  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.e70a5c17baf18a00374045c27fcfde6b01e13c09725e4b14d4678967f0eb3259313a3e1f4e65e09a68e20dce4dddfa78b2acc620080030af2e459d4fa85a5974.css"
    integrity="sha512-5wpcF7rxigA3QEXCf8/eawHhPAlyXksU1GeJZ/DrMlkxOj4fTmXgmmjiDc5N3fp4sqzGIAgAMK8uRZ1PqFpZdA=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.4df8309499991be53c71b2b39ba0f5d5e77ea7d411d0710ce48c24218e7cc24ded28f19e85838fdc56db2306195cb001f049f577be0cf0ffb2dd6e2037ede1b9.js" integrity="sha512-TfgwlJmZG&#43;U8cbKzm6D11ed&#43;p9QR0HEM5IwkIY58wk3tKPGehYOP3FbbIwYZXLAB8En1d74M8P&#43;y3W4gN&#43;3huQ=="></script>
  
  
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Alaska 2020 Early Vote Tracker - Rmarkdown report" />
<meta property="og:description" content="**TL:DR, I made an rmarkdown site tracking Alaska&rsquo;s early and mail vote as ballots arrived each day in October/November 2020." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/mail-in-2020/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-01T22:05:17-08:00" />
<meta property="article:modified_time" content="2021-01-01T22:05:17-08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Alaska 2020 Early Vote Tracker - Rmarkdown report"/>
<meta name="twitter:description" content="**TL:DR, I made an rmarkdown site tracking Alaska&rsquo;s early and mail vote as ballots arrived each day in October/November 2020."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "",
    "name": "Alaska 2020 Early Vote Tracker - Rmarkdown report",
    "headline": "Alaska 2020 Early Vote Tracker - Rmarkdown report",
    
    "abstract": "**TL:DR, I made an rmarkdown site tracking Alaska\u0026rsquo;s early and mail vote as ballots arrived each day in October\/November 2020.",
    "inLanguage": "en-US",
    "url" : "\/posts\/mail-in-2020\/",
    "author" : {
      "@type": "Person",
      "name": "Ben Matheson"
    },
    "copyrightYear": "2021",
    "dateCreated": "2021-01-01T22:05:17-08:00",
    "datePublished": "2021-01-01T22:05:17-08:00",
    
    "dateModified": "2021-01-01T22:05:17-08:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1079"
  }]
  </script>


  
  
  
  <meta name="author" content="Ben Matheson" />
  
    
      <link href="https://twitter.com/benmatheson" rel="me" />
    
  
  
  






  
  
  
  


  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Skip to main content</a
      >
    </div><header
  class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"
>
  
  <div>
    
      <a
        class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
        rel="me"
        href="/"
        >Ben Matheson</a
      >
    

  </div>
  
  
    <nav>
      <ul class="flex flex-col list-none sm:flex-row">
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/posts/"
              title=""
              >Writing</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/projects/"
              title="Projects"
              >Projects</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/contact/"
              title="Contact"
              >Contact</a
            >
          </li>
        
        
      </ul>
    </nav>
  
</header>
<main id="main-content" class="relative grow">
  <article>
    <header class="max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Alaska 2020 Early Vote Tracker - Rmarkdown report
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <p>**<em>TL:DR, I made an rmarkdown site <a href="https://benmatheson.github.io/alaska_2020_early_absentee_vote/early_vote_md.html">tracking Alaska&rsquo;s early and mail vote</a> as ballots arrived each day in October/November 2020.</em></p>
<p>Alaskans voted by mail in record numbers during the 2020/pandemic general election. In mid-October after I mailed in my ballot, I started poking around the Alaska Division of Elections website to see if they had any reports on the incoming ballots. I found a <a href="https://www.elections.alaska.gov/results/20GENR/data/sovc/CombinedBallotCountReport_Server.pdf">daily updated PDF</a> of mail votes, early votes, rejected ballots, and the ballots outstanding.</p>
<p><img src="images/early_vote/pdf1.png" alt="plot1" title="" /></p>
<p>Though it&rsquo;s in a PDF, this was the data I was looking for. While the Division of Elections emails out a full updated voter file quite frequently that&rsquo;s very granular and tracks things like party registration, I wanted to use a dataset that was machine-readable on the web. And the resolution down to actual voters was a little too much for what I wanted to track, which was:</p>
<p><em>What areas of the state are  most enthusiastically particpating in vote-by-mail? Which are not taking part? What areas are seeing the most rejected ballots?</em></p>
<p>This Alaska House District-level data is locked in the PDF above, but it seemed organized and consistent. I wanted to see if I could break this data out of the PDF and show it how I wanted to see it. Like all of my side projects, it&rsquo;s made for an audeince of one: me. If anyone else enjoys it, that&rsquo;s a bonus.</p>
<p>My go-to tool for parsing PDFs is <a href="https://tabula.technology/">Tabula</a>. It&rsquo;s what parses the 208-page pdf for my [pfdBot twitterbot] (<a href="http://twitter.com/pfdbot)">http://twitter.com/pfdbot)</a>. Thus I hoped to use the R package <a href="https://cran.r-project.org/web/packages/tabulizer/vignettes/tabulizer.html">Tabulizer</a> and have all of this run in an rscript or rmarkdown report. For the life of me, I could not get its rJava dependency installed on my laptop. I went deep, deep, deep into StackOverflow topics from 10 years ago. I installed many version of Java. I signed up for the Oracle newsletter I think. Many hours went into attempting that.</p>
<p>My workaround was to use the <a href="https://tabula-py.readthedocs.io/en/latest/">Tabula-py</a> python library for the PDF parsing, and R for the rest. I had one python script that would download the PDF from the Divison of Elections, compare it&rsquo;s update date to the latest date I had saved in a file, and if it was new, then it would use a tabula function to parse and spit out a CSV.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.elections.alaska.gov/results/20GENR/data/sovc/CombinedBallotCountReport_Server.pdf&#34;</span>

tabula<span style="color:#f92672">.</span>convert_into(url, <span style="color:#e6db74">&#34;output_current.csv&#34;</span>, output_format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;csv&#34;</span>, pages<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;all&#39;</span>)

</code></pre></div><p>With some projects, the hard parts are easy and the easy parts are hard. This is one of those projects. After running the PDF through tabula-py, I got something that looked like this:</p>
<p><img src="images/early_vote/csv1.png" alt="plot1" title="" /></p>
<p>Much better. That one line of python is fantastic. After a bunch of reshaping and adding in new fields like percentages in R with dyplyr, I had the base data for the rmarkdown report.  It was not a pretty system but it worked for the three or four weeks that this was running.</p>
<p>I had been using <a href="https://rmarkdown.rstudio.com/">Rmarkdown</a> to run a handful of reports with COVID-19 information at work, and this seemed like a really nice fit for rmarkdown reports. Load in new data each day, run it, and push to the web.</p>
<p>This is the <a href="https://benmatheson.github.io/alaska_2020_early_absentee_vote/early_vote_md.html">final product</a>.</p>
<p>The ggplot thoroughout was pretty basic, though getting the details right is the time-consuming part. I wanted to show all 40 districts at once, so it&rsquo;s a bit dense, but this is what I wanted.</p>
<p><img src="images/early_vote/hd_2016_status.png" alt="plot1" title="" /></p>
<p>Alaska&rsquo;s 40 House districts cover all the diversity of the state..from the ferry-connected towns in Southeast to the exurban Mat-Su and all the  I wanted to add one level of geographic categorization. It&rsquo;s not intuitive to know that HD33 represents downtown Juneau while HD32 covers Kodiak. So I made up six regional designations, show in the colors of the bars below. These are made up out of thin air.</p>
<p><img src="images/early_vote/hd_2016_turnout.png" alt="plot1" title="" /></p>
<p>I wanted to show how different the voting landscape was across the state. Vote by mail was far less utilized in rural parts of the state in the west and north compared to urban Anchorage districts. Less than 10% of the 2016-level turnout voted by mail in the west and north, while you see in that mass of light blue bars that nine Anchorage districts were at ~40%.</p>
<p>I was at a couple points really close to making a map to show the regional trends, but I decided against it. The world has enough election maps.</p>
<p>The in-person early vote also saw a huge particpation this year. But it was the Juneau Mendenhall Valley (the &ldquo;conservative&rdquo; part of Juneau - shown in green) as well as the Mat-Su districts (shown in red-purple) that really outperfomred with early in-person.</p>
<p><img src="images/early_vote/hd_participation.png" alt="plot1" title="" /></p>
<p>I brought in some historical data to make the raw numbers a bit more meaningful. I grabbed 2016 vote turnout numbers as well as the Trump-Clinton margin for a partisan measurement. Would redder parts of Alaska follow the national trend and skip the mail voting? (the answer: yes, but with the big exception of HD-38,HD-39, and HD-40 the bush districts).</p>
<p><img src="images/early_vote/hd_2016_partisan.png" alt="plot1" title="" /></p>
<p>The couple of scatter plots comparing voter registration and vote-by-mail aren&rsquo;t exactly thrilling, but it was useful for day-to-day on-the-fly exploratory data analysis. You can see the same regional trends pop out, though labelling is hard. I wanted to include all 40 labels. If I was doing something for a real presentation, I&rsquo;d be a lot more selective on what&rsquo;s labelled and how.</p>
<p><img src="images/early_vote/hd_2016_reg_voters.png" alt="plot1" title="" /></p>
<p>I had a lot of fun making a table using the gt pacakge. I&rsquo;d like to do a lot more with it.</p>
<p><img src="images/early_vote/table.png" alt="plot1" title="" /></p>
<p>This looked something like this:</p>
<pre tabindex="0"><code>gt(votes_mail_early %&gt;% select (district_number, district_description, ballots_received, ballots_sent, reject, accept_full) %&gt;% arrange(desc(ballots_received))) %&gt;% 
 data_color(
    columns = vars(ballots_received),
    colors = scales::col_numeric(
      palette = paletteer::paletteer_d(
        palette = &quot;ggsci::teal_material&quot;
        ) %&gt;% as.character(),
      domain = NULL
      )) %&gt;% 
   data_color(
    columns = vars(accept_full),
    colors = scales::col_numeric(
      palette = paletteer::paletteer_d(
        palette = &quot;ggsci::light_blue_material&quot;
        ) %&gt;% as.character(),
      domain = NULL
      )) %&gt;% 
    cols_label(
    district_number = &quot;District Number&quot;,
    district_description = &quot;District&quot;,
    ballots_received= &quot;Mail Ballots Received&quot;,
    ballots_sent = &quot;Mail Ballots Sent&quot;,
    reject = &quot;Mail Ballots Rejected&quot;,
    accept_full = &quot;Early Vote in Person&quot;
  ) %&gt;% opt_row_striping() %&gt;% tab_style( cell_text(weight = &quot;bold&quot;), locations = cells_column_labels(columns = vars(district_number, district_description, ballots_received, ballots_sent, reject, accept_full)))
</code></pre><p>I had the R script do a few system calls to push the data up to a github repository as well as commit the output html to the web.  Not sure if I recommend this.</p>
<pre tabindex="0"><code>system_call &lt;- paste0(
  
  &quot;git add early_vote_md.html &quot; ,  &quot;data/output/&quot;,report_date,&quot;_&quot;,&quot;alaska_early_vote.csv
    git commit -m  \&quot;update \&quot; 
    git push origin master&quot;
  
)


system(system_call)

</code></pre><p>You can <a href="https://benmatheson.github.io/alaska_2020_early_absentee_vote/early_vote_md.html">check out the full website</a>.</p>

      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      

      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/posts/testing-website/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >AnchorageCovidTesting.org Website</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/posts/gov-oil/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Alaska Governors' Wild Ride on Oil Prices</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    </footer>
    
  </article>

      
        <div
          class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-[-5.5rem]"
        >
          <a
            href="#the-top"
            class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
            aria-label="Scroll to top"
            title="Scroll to top"
          >
            &uarr;
          </a>
        </div>
      
    </main>
    <footer class="py-10 print:hidden">
  
  
  <div class="flex justify-between">
    <div>
      
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2022
          Ben Matheson
      </p>
      
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Switch to dark appearance"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>
</body>
</html>
